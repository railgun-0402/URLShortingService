# v2
まずは永続化対応をする。

v3以降でスケールやカウント・インフラ構成などを考えていく。

## 🧱 v2 のゴール
- in-memory 実装→PostgreSQL永続化
- API 仕様はそのまま（POST /shorten, GET /:id）
- アプリ再起動しても短縮URLが消えない状態にする

## 1️⃣ テーブル設計（PostgreSQL）

- シンプルに1テーブル

```sql
CREATE TABLE short_urls (
    id           VARCHAR(16) PRIMARY KEY,   -- 短縮ID (Base62)
    original_url TEXT        NOT NULL,      -- 元URL
    created_at   TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- よくある拡張:
-- created_at で新着順に並べたい場合は index を貼る
CREATE INDEX idx_short_urls_created_at ON short_urls (created_at);
```
- id … Base62 8文字くらい想定（余裕見て 16 にしとく）
- original_url … 長さ読めないので TEXT
- created_at … とりあえず NOW() デフォルト

## 2️⃣ Postgres コンテナを立てる（ローカル用）
タイトルの通り

## 3️⃣ 動作確認（v1 と同じ curl でOK）

### ①短縮URL作成
```bash
curl -X POST http://localhost:8080/shorten \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com/v2-postgres"}'
```

### ② リダイレクト確認
```bash
curl -i http://localhost:8080/<返ってきたid>
```

### ③ 再起動しても残ってるか確認
- サーバー止める
- 再起動
- 同じ id に GET
```bash
curl -i http://localhost:8080/<返ってきたid>
```
→ 302 で飛べたら v2 永続化成功 💪
